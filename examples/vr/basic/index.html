<!DOCTYPE html>
<html lang="en">
  <head>
    <title>three.xr.js VR simplest example</title>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, user-scalable=no, minimum-scale=1.0, maximum-scale=1.0">
    <style>
      body, html {
        padding: 0;
        margin: 0;
        width: 100%;
        height: 100%;
        -webkit-user-select: none;
        user-select: none;
      }
      #target {
        width: 100%;
        height: 100%;
        position: absolute;
        z-index: 100;
      }
      .enter-vr-button {
        position: absolute;
        bottom: 20px;
        left: 50%;
        transform: translate(-50%, -50%);
        font-size: 2em;
        padding: 10px;
      }
    </style>
  </head>
  <body>
    <script src="../../../vendor/three.js"></script>
    <script src="../../../vendor/webxr-polyfill.js"></script>
    <script src='../../../three.xr.js'></script>
    <div id="target" />
    <script>
      var clock = new THREE.Clock();

      var container;
      var renderer, camera, scene;
      var xrDisplays;

      var cube;

      var enterVRButton = document.createElement('button');

      THREE.WebXRUtils.getDisplays().then(init);

      function init(displays) {
        xrDisplays = displays;

        container = document.createElement( 'div' );
        document.body.appendChild( container );
        
        scene = new THREE.Scene();
        camera = new THREE.PerspectiveCamera();
        scene.add( camera );

        renderer = new THREE.WebGLRenderer( { alpha: true } );
        renderer.setPixelRatio(window.devicePixelRatio);
        renderer.autoClear = false;
        container.appendChild( renderer.domElement );

        // Add custom content
        var geometry = new THREE.BoxGeometry(0.2, 0.2, 0.2);
        var material = new THREE.MeshNormalMaterial();
        cube = new THREE.Mesh(geometry, material);
        cube.position.set(0, 0, -1);
        scene.add (cube);
        // End custom content
        window.addEventListener( 'resize', onWindowResize, false );
        onWindowResize();

        renderer.xr = new THREE.WebXRManager(xrDisplays, renderer, camera, scene, update);
        renderer.xr.startSession( true, false );
      }

      function onWindowResize() {
        camera.aspect = window.innerWidth / window.innerHeight;
        camera.updateProjectionMatrix();
      }

      // Called once per frame, before render, to give the app a chance to update this.scene
      function update(frame) {
        var delta = clock.getDelta() * 60;
        cube.rotation.y += delta * 0.01;
      }

      window.addEventListener('vrdisplaypresentchange', (evt) => {
          // Polyfill places display inside the detail property
          var display = evt.display || evt.detail.display;
          if (!display.isPresenting) {
            // Exiting VR.
            renderer.xr.stopPresenting();
            document.getElementById('target').style.display = 'block';
          }
      });

      window.addEventListener('DOMContentLoaded', () => {
        // HMDs require the call to start presenting to occur due to a user input event, so make a button to trigger that
        enterVRButton.setAttribute('class', 'enter-vr-button');
        document.getElementById('target').appendChild(enterVRButton);
        enterVRButton.innerHTML = 'Enter VR';
        enterVRButton.addEventListener('click', ev => {
          renderer.xr.startPresenting();
          document.getElementById('target').style.display = 'none';
        })
      });
    </script>
  </body>
</html>